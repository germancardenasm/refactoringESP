!function(e){e.fn.columnize=function(t){var n={width:400,columns:!1,buildOnce:!1,overflow:!1,doneFunc:function(){},target:!1,ignoreImageLoading:!0,columnFloat:"left",lastNeverTallest:!1,accuracy:!1},t=e.extend(n,t);return"string"==typeof t.width&&(t.width=parseInt(t.width),isNaN(t.width)&&(t.width=n.width)),this.each(function(){function n(n,i,r,o){for(;r.height()<o&&i[0].childNodes.length;)n.append(i[0].childNodes[0]);if(0!=n[0].childNodes.length){var a=n[0].childNodes,s=a[a.length-1];n[0].removeChild(s);var l=e(s);if(3==l[0].nodeType){var c=l[0].nodeValue,u=t.width/18;t.accuracy&&(u=t.accuracy);for(var d,h=null;r.height()<o&&c.length;)d="-1"!=c.indexOf(" ",u)?c.substring(0,c.indexOf(" ",u)):c,h=document.createTextNode(d),n.append(h),c=c.length>u?c.substring(c.indexOf(" ",u)):"";if(r.height()>=o&&null!=h&&(n[0].removeChild(h),c=h.nodeValue+c),!c.length)return!1;l[0].nodeValue=c}return i.children().length?i.prepend(l):i.append(l),3==l[0].nodeType}}function i(e,t,r,o){t.children().length&&($cloneMe=t.children(":first"),$clone=$cloneMe.clone(!0),1!=$clone.prop("nodeType")||$clone.hasClass("dontend")||(e.append($clone),$clone.is("img")&&r.height()<o+20?$cloneMe.remove():!$cloneMe.hasClass("dontsplit")&&r.height()<o+20?$cloneMe.remove():$clone.is("img")||$cloneMe.hasClass("dontsplit")?$clone.remove():($clone.empty(),n($clone,$cloneMe,r,o)||$cloneMe.children().length&&i($clone,$cloneMe,r,o),0==$clone.get(0).childNodes.length&&$clone.remove())))}function r(){if(!s.data("columnized")||1!=s.children().length){if(s.data("columnized",!0),s.data("columnizing",!0),s.empty(),s.append(e("<div class='first last column' style='width:100%; float: "+t.columnFloat+";'></div>")),$col=s.children().eq(s.children().length-1),$destroyable=c.clone(!0),t.overflow){for(targetHeight=t.overflow.height,n($col,$destroyable,$col,targetHeight),$destroyable.contents().find(":first-child").hasClass("dontend")||i($col,$destroyable,$col,targetHeight);o($col.children(":last").length&&$col.children(":last").get(0));){var r=$col.children(":last");r.remove(),$destroyable.prepend(r)}for(var a="",l=document.createElement("DIV");$destroyable[0].childNodes.length>0;){for(var u=$destroyable[0].childNodes[0],d=0;d<u.attributes.length;d++)0==u.attributes[d].nodeName.indexOf("jQuery")&&u.removeAttribute(u.attributes[d].nodeName);l.innerHTML="",l.appendChild($destroyable[0].childNodes[0]),a+=l.innerHTML}var h=e(t.overflow.id)[0];h.innerHTML=a}else $col.append($destroyable);s.data("columnizing",!1),t.overflow&&t.overflow.doneFunc()}}function o(t){return 1==t.nodeType&&(!!e(t).hasClass("dontend")||0!=t.childNodes.length&&o(t.childNodes[t.childNodes.length-1]))}function a(){if(u!=s.width()){u=s.width();var a=Math.round(s.width()/t.width);if(t.columns&&(a=t.columns),a<=1)return r();if(!s.data("columnizing")){s.data("columnized",!0),s.data("columnizing",!0),s.empty(),s.append(e("<div style='width:"+Math.floor(100/a)+"%; float: "+t.columnFloat+";'></div>")),b=s.children(":last"),b.append(c.clone()),l=b.height(),s.empty();var h=l/a,f=3,p=!1;t.overflow?(f=1,h=t.overflow.height):t.height&&t.width&&(f=1,h=t.height,p=!0);for(var m=0;m<f;m++){s.empty();var g;try{g=c.clone(!0)}catch(e){g=c.clone()}g.css("visibility","hidden");for(var v=0;v<a;v++){var y=0==v?"first column":"column",y=v==a-1?"last "+y:y;s.append(e("<div class='"+y+"' style='width:"+Math.floor(100/a)+"%; float: "+t.columnFloat+";'></div>"))}for(var v=0;v<a-(t.overflow?0:1)||p&&g.contents().length;){s.children().length<=v&&s.append(e("<div class='"+y+"' style='width:"+Math.floor(100/a)+"%; float: "+t.columnFloat+";'></div>"));var b=s.children().eq(v);for(n(b,g,b,h),g.contents().find(":first-child").hasClass("dontend")||i(b,g,b,h);o(b.children(":last").length&&b.children(":last").get(0));){var x=b.children(":last");x.remove(),g.prepend(x)}v++}if(t.overflow&&!p){var w=!1,_=document.all&&navigator.appVersion.indexOf("MSIE 7.")!=-1;if(w||_){for(var k="",C=document.createElement("DIV");g[0].childNodes.length>0;){for(var T=g[0].childNodes[0],v=0;v<T.attributes.length;v++)0==T.attributes[v].nodeName.indexOf("jQuery")&&T.removeAttribute(T.attributes[v].nodeName);C.innerHTML="",C.appendChild(g[0].childNodes[0]),k+=C.innerHTML}var S=e(t.overflow.id)[0];S.innerHTML=k}else e(t.overflow.id).empty().append(g.contents().clone(!0))}else if(p)s.children().each(function(e){b=s.children().eq(e),b.width(t.width+"px"),0==e?b.addClass("first"):e==s.children().length-1?b.addClass("last"):(b.removeClass("first"),b.removeClass("last"))}),s.width(s.children().length*t.width+"px");else{for(b=s.children().eq(s.children().length-1);g.contents().length;)b.append(g.contents(":first"));var M=(b.height(),0),E=1e7,O=0,A=!1;s.children().each(function(e){return function(t){var n=e.children().eq(t).height();A=!1,M+=n,n>O&&(O=n,A=!0),n<E&&(E=n)}}(s));var P=M/a;t.lastNeverTallest&&A?(d+=30,d<100?(h+=30,m==f-1&&f++):m=f):O-E>30?h=P+30:Math.abs(P-h)>20?h=P:m=f}s.append(e("<br style='clear:both;'>"))}s.find(".column").find(":first.removeiffirst").remove(),s.find(".column").find(":last.removeiflast").remove(),s.data("columnizing",!1),t.overflow&&t.overflow.doneFunc(),t.doneFunc()}}}var s=e(t.target?t.target:this),l=e(this).height(),c=e("<div></div>"),u=0,d=0;if(c.append(e(this).contents().clone(!0)),!t.ignoreImageLoading&&!t.target&&!s.data("imageLoaded")&&(s.data("imageLoaded",!0),e(this).find("img").length>0)){var h=function(e,n){return function(){e.data("firstImageLoaded")||(e.data("firstImageLoaded","true"),e.empty().append(n.children().clone(!0)),e.columnize(t))}}(e(this),c);return e(this).find("img").one("load",h),void e(this).find("img").one("abort",h)}s.empty(),a(),t.buildOnce||e(window).resize(function(){!t.buildOnce&&e.browser.msie?(s.data("timeout")&&clearTimeout(s.data("timeout")),s.data("timeout",setTimeout(a,200))):t.buildOnce||a()})})}}(jQuery);